{% extends 'base.html.twig' %}

{% block title %}User management{% endblock %}

{% block body %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">User management</h1>
    <a class="btn btn-outline-secondary" href="{{ path('admin_dashboard') }}">Back to dashboard</a>
  </div>

  {% for label, messages in app.flashes %}
    {% for message in messages %}
      <div class="alert alert-{{ label }}">{{ message }}</div>
    {% endfor %}
  {% endfor %}

  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>Email</th>
        <th>Roles</th>
        <th>Active</th>
        <th class="text-end">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
        <tr>
          <td>{{ u.id }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.roles|join(', ') }}</td>
          <td>
            {% if u.isActive %}
              <span class="badge bg-success">Active</span>
            {% else %}
              <span class="badge bg-secondary">Pending</span>
            {% endif %}
          </td>
          <td class="text-end">
            <form method="post" action="{{ path('admin_user_toggle_active', {id: u.id}) }}">
              <input type="hidden" name="_token" value="{{ csrf_token('toggle_active_' ~ u.id) }}">
              <button class="btn btn-sm btn-primary">
                {% if u.isActive %}Deactivate{% else %}Activate{% endif %}
              </button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}